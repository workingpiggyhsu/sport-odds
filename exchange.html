<!DOCTYPE html>
<html lang="zh-Hant" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Exchange Match Odds è¨ˆç®—å™¨</title>
  <style>
    /* =======================
       THEME TOKENS
       ======================= */
    :root{
      /* Dark (default) */
      --bg:#0f1117;
      --panel:#151a22;
      --card-bg:#0f131a;
      --help-bg:#0e151f;
      --thead-bg:#111725;
      --tab-bg:#0c1118;
      --tab-active-bg:#1b2433;
      --input-bg:#0b0f14;
      --button-bg:#111827;
      --line:#243041;
      --text:#e8edf3;
      --thead-text:#b7c2dd;
      --muted:#9aa6bf;

      --blue:#4da3ff;
      --pink:#ff79c6;
      --green:#39d98a;
      --red:#ff6b6b;
      --amber:#ffbf69;

      --pill-blue-bg:#13233a;
      --pill-blue-text:#a9cfff;
      --pill-pink-bg:#301c2a;
      --pill-pink-text:#ff9ac3;
    }
    [data-theme='light']{
      /* Light */
      --bg:#f7f7fb;
      --panel:#ffffff;
      --card-bg:#ffffff;
      --help-bg:#f2f5fb;
      --thead-bg:#eef2f7;
      --tab-bg:#f2f4f8;
      --tab-active-bg:#e7ecf5;
      --input-bg:#ffffff;
      --button-bg:#f3f4f6;
      --line:#e4e7ec;
      --text:#101828;
      --thead-text:#475467;
      --muted:#667085;

      --blue:#2563eb;
      --pink:#c026d3;
      --green:#039855;
      --red:#d92d20;
      --amber:#b54708;

      --pill-blue-bg:#eaf2ff;
      --pill-blue-text:#003366;
      --pill-pink-bg:#fde9ff;
      --pill-pink-text:#6a006e;
    }

    /* =======================
       BASE
       ======================= */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:"Noto Sans TC","Microsoft JhengHei","PingFang TC",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.55;
    }
    header{padding:22px 16px 6px}
    h1{margin:0 0 4px; font-weight:800; letter-spacing:.3px}
    .sub{color:var(--muted); font-size:14px; display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .wrap{max-width:1200px; margin:0 auto; padding:12px 16px 28px}
    .card{background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:16px; box-shadow:0 10px 28px rgb(0 0 0 / .12)}
    .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    .right{margin-left:auto}
    label.small{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input,select,button{
      border-radius:10px; padding:10px 12px; border:1px solid var(--line);
      background:var(--input-bg); color:var(--text); outline:none;
    }
    input[type="number"]{width:120px}
    button{cursor:pointer; background:var(--button-bg); transition:.15s}
    button:hover{transform:translateY(-1px); box-shadow:0 6px 14px rgb(0 0 0 / .12)}
    .btn{border:1px solid var(--line)}
    .btn-primary{background:linear-gradient(135deg,#355cff,#8e76ff); border:none; color:#fff}
    .btn-danger{background:linear-gradient(135deg,#ff5a5a,#ff7a7a); border:none; color:#fff}
    .tabs{display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap}
    .tab{padding:10px 14px; border-radius:999px; border:1px solid var(--line); cursor:pointer; font-weight:700; color:var(--text); background:var(--tab-bg)}
    .tab.active{background:var(--tab-active-bg); box-shadow:inset 0 0 0 1px rgba(64,80,114,.6)}
    table{width:100%; border-collapse:separate; border-spacing:0}
    thead th{
      position:sticky; top:0; z-index:1; background:var(--thead-bg);
      color:var(--thead-text); font-weight:700; text-align:left; font-size:13px; padding:10px; border-bottom:1px solid var(--line)
    }
    tbody td{padding:8px 10px; border-bottom:1px dashed var(--line); vertical-align:middle}
    tr:last-child td{border-bottom:0}
    .grid{overflow:auto; border:1px solid var(--line); border-radius:12px}
    .num{font-variant-numeric:tabular-nums}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px}
    .pill.blue{background:var(--pill-blue-bg); color:var(--pill-blue-text)}
    .pill.pink{background:var(--pill-pink-bg); color:var(--pill-pink-text)}
    .sum{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; margin-top:12px}
    .box{background:var(--card-bg); border:1px solid var(--line); border-radius:12px; padding:12px}
    .box h4{margin:0 0 6px; color:var(--thead-text); font-size:13px}
    .val{font-size:22px; font-weight:800}
    .pos{color:var(--green)} .neg{color:var(--red)}
    details{border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:var(--card-bg)}
    details+details{margin-top:8px}
    details summary{cursor:pointer; font-weight:800; letter-spacing:.2px; color:var(--text)}
    .help{background:var(--help-bg); border:1px solid var(--line); border-radius:12px; padding:12px; margin:12px 0}
    .help h3{margin:0 0 8px; color:var(--text)}
    ul.clean{margin:0; padding-left:18px}
    .muted{color:var(--muted)}
    .foot{margin-top:10px; color:var(--muted); font-size:12px}
    .section-title{margin:16px 0 8px; font-weight:800; letter-spacing:.3px; color:var(--text)}
    .warn{color:var(--amber); font-weight:700}
    .grid2{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px}
    @media (max-width:900px){
      .sum{grid-template-columns:1fr}
      .grid2{grid-template-columns:1fr}
      input[type="number"]{width:100%}
    }
  
    /* Panels: show only active */
    .panel{display:none}
    .panel.active{display:block}
</style>
</head>
<body>
  <header class="wrap">
    <h1>Exchange Match Odds è¨ˆç®—å™¨</h1>
    <div class="sub">
      <span>å…ˆæ“ä½œ <strong>2-Way / 3-Way</strong>ï¼Œä½£é‡‘è¨­å®šåœ¨ä¸‹æ–¹ã€‚ç¶ åŒ–èˆ‡å¿«é€Ÿå°æ²–å¯æ”¶åˆã€‚</span>
      <span class="right"></span>
      <button id="theme-toggle" class="btn" title="åˆ‡æ›æ·±è‰²/æ·ºè‰²ä¸»é¡Œ">åˆ‡æ›ç‚ºæ·ºè‰²</button>
    </div>
  </header>

  <main class="wrap card">
    <!-- é ‚éƒ¨ Tabs -->
    <div class="tabs" role="tablist">
      <button class="tab active" data-tab="two">2-Wayï¼ˆå…©è·¯ç›¤ï¼‰</button>
      <button class="tab" data-tab="three">3-Wayï¼ˆä¸‰è·¯ç›¤ï¼‰</button>
    </div>

    <!-- 2-Way Panel -->
    <section class="panel active" id="panel-two" aria-labelledby="two">
      <div class="row" style="margin-bottom:8px">
        <span class="pill blue">Back = è²·é€²/æ”¯æŒï¼ˆåå¥½é«˜åƒ¹ï¼‰</span>
        <span class="pill pink">Lay = è³£å‡º/åå‘ï¼ˆåå¥½ä½åƒ¹ï¼‰</span>
        <div class="right row">
          <button class="btn" id="two-add">æ–°å¢æ³¨å–®</button>
          <button class="btn-danger" id="two-clear">æ¸…ç©º</button>
          <button class="btn-primary" id="two-demo">è¼‰å…¥ç¤ºä¾‹</button>
        </div>
      </div>
      <div class="grid">
        <table aria-label="2-Way bets">
          <thead>
            <tr>
              <th>#</th>
              <th>çµæœ</th>
              <th>é¡å‹</th>
              <th>è³ ç‡<br><span class="muted">Decimal</span></th>
              <th>æŠ•æ³¨é¡<br><span class="muted">Stake</span></th>
              <th>æç›Šï¼ˆè‹¥ ä¸»å‹ï¼‰</th>
              <th>æç›Šï¼ˆè‹¥ å®¢å‹ï¼‰</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="two-rows"></tbody>
        </table>
      </div>

      <div class="sum">
        <div class="box">
          <h4>ä¸»å‹ï¼ˆå°è¨ˆï¼ä½£é‡‘ï¼æ·¨é¡ï¼‰</h4>
          <div class="val num" id="two-r1">0.00</div>
          <div class="muted">ä½£é‡‘ï¼š<span id="two-r1-comm">0.00</span> â†’ æ·¨ <span id="two-r1-net">0.00</span></div>
        </div>
        <div class="box">
          <h4>å®¢å‹ï¼ˆå°è¨ˆï¼ä½£é‡‘ï¼æ·¨é¡ï¼‰</h4>
          <div class="val num" id="two-r2">0.00</div>
          <div class="muted">ä½£é‡‘ï¼š<span id="two-r2-comm">0.00</span> â†’ æ·¨ <span id="two-r2-net">0.00</span></div>
        </div>
        <div class="box">
          <h4>ä¸å¹³è¡¡åº¦ï¼ˆæ·¨é¡å·®ï¼‰</h4>
          <div class="val num" id="two-gap">0.00</div>
          <div class="muted">è¶Šæ¥è¿‘ 0 ä»£è¡¨è¶Šå¹³è¡¡</div>
        </div>
      </div>
    </section>

    <!-- 3-Way Panel -->
    <section class="panel" id="panel-three" aria-labelledby="three">
      <div class="row" style="margin-bottom:8px">
        <span class="pill blue">Back = è²·é€²/æ”¯æŒ</span>
        <span class="pill pink">Lay = è³£å‡º/åå‘</span>
        <div class="right row">
          <button class="btn" id="three-add">æ–°å¢æ³¨å–®</button>
          <button class="btn-danger" id="three-clear">æ¸…ç©º</button>
          <button class="btn-primary" id="three-demo">è¼‰å…¥ç¤ºä¾‹</button>
        </div>
      </div>
      <div class="grid">
        <table aria-label="3-Way bets">
          <thead>
            <tr>
              <th>#</th>
              <th>çµæœ</th>
              <th>é¡å‹</th>
              <th>è³ ç‡<br><span class="muted">Decimal</span></th>
              <th>æŠ•æ³¨é¡<br><span class="muted">Stake</span></th>
              <th>æç›Šï¼ˆä¸»å‹ï¼‰</th>
              <th>æç›Šï¼ˆå’Œå±€ï¼‰</th>
              <th>æç›Šï¼ˆå®¢å‹ï¼‰</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="three-rows"></tbody>
        </table>
      </div>

      <div class="sum">
        <div class="box">
          <h4>ä¸»å‹ï¼ˆå°è¨ˆï¼ä½£é‡‘ï¼æ·¨é¡ï¼‰</h4>
          <div class="val num" id="three-h">0.00</div>
          <div class="muted">ä½£é‡‘ï¼š<span id="three-h-comm">0.00</span> â†’ æ·¨ <span id="three-h-net">0.00</span></div>
        </div>
        <div class="box">
          <h4>å’Œå±€ï¼ˆå°è¨ˆï¼ä½£é‡‘ï¼æ·¨é¡ï¼‰</h4>
          <div class="val num" id="three-d">0.00</div>
          <div class="muted">ä½£é‡‘ï¼š<span id="three-d-comm">0.00</span> â†’ æ·¨ <span id="three-d-net">0.00</span></div>
        </div>
        <div class="box">
          <h4>å®¢å‹ï¼ˆå°è¨ˆï¼ä½£é‡‘ï¼æ·¨é¡ï¼‰</h4>
          <div class="val num" id="three-a">0.00</div>
          <div class="muted">ä½£é‡‘ï¼š<span id="three-a-comm">0.00</span> â†’ æ·¨ <span id="three-a-net">0.00</span></div>
        </div>
      </div>

      <div class="box" style="margin-top:10px">
        <h4>ä¸å¹³è¡¡åº¦ï¼ˆæœ€å¤§æ·¨é¡ âˆ’ æœ€å°æ·¨é¡ï¼‰</h4>
        <div class="val num" id="three-gap">0.00</div>
        <div class="muted">è¶Šæ¥è¿‘ 0 ä»£è¡¨è¶Šå¹³è¡¡</div>
      </div>
    </section>

    <!-- èªªæ˜é‡é»ï¼ˆå¯æ”¶åˆï¼‰ -->
    <details>
      <summary>ğŸ“˜ èªªæ˜é‡é»ï¼ˆæ¢åˆ—ç‰ˆï¼‰</summary>
      <div class="help">
        <h3>åŸºæœ¬è§€å¿µ</h3>
        <ul class="clean">
          <li><strong>Back</strong> ï¼ è²·é€²ï¼æ”¯æŒï¼ˆè¦ºå¾—æœƒç™¼ç”Ÿï¼‰ã€‚</li>
          <li><strong>Lay</strong> ï¼ è³£å‡ºï¼åå‘ï¼ˆè¦ºå¾—ä¸æœƒç™¼ç”Ÿï¼‰ã€‚</li>
          <li>åé€²åˆ¶è³ ç‡ï¼ˆDecimalï¼‰å·²å«æœ¬é‡‘ï¼Œè¨ˆç®—æ™‚éœ€å…ˆ <strong>(è³ ç‡ âˆ’ 1)</strong>ã€‚</li>
        </ul>
        <h3 style="margin-top:8px">è¨ˆç®—å…¬å¼</h3>
        <ul class="clean">
          <li><strong>Back æ·¨åˆ©</strong>ï¼š<code>stake Ã— (odds âˆ’ 1)</code>ï¼›æœªç™¼ç”Ÿ = <code>âˆ’stake</code></li>
          <li><strong>Lay</strong>ï¼šç™¼ç”Ÿ = <code>âˆ’ stake Ã— (odds âˆ’ 1)</code>ï¼›æœªç™¼ç”Ÿ = <code>+ stake</code></li>
        </ul>
      </div>
    </details>

    <!-- å¯æ”¶åˆï¼šä¸€éµå…¨ç›¤ç¶ åŒ– -->
    <details id="greenup">
      <summary>ğŸŸ¢ ä¸€éµå…¨ç›¤ç¶ åŒ–ï¼ˆè‡ªå‹•è¨ˆç®—å»ºè­°æ³¨é¡ï¼‰</summary>
      <div class="muted" style="margin:6px 0 10px">ä»¥ç›®å‰è¡¨æ ¼çš„æ³¨å–®ç‚ºåŸºç¤ï¼Œå˜—è©¦ç”¨ã€Œæœ€å°‘ç­†æ•¸ã€å°æ²–ä½¿å„çµæœæ·¨é¡è¶¨æ–¼ä¸€è‡´ã€‚å…ˆä»¥æœªæ‰£ä½£é‡‘ç­‰é¡æ±‚è§£ï¼Œä¸¦åŒæ™‚é¡¯ç¤ºå«ä½£é‡‘å¾Œæ•ˆæœã€‚</div>
      <div class="grid2">
        <div class="box">
          <h4>2-Way ç¶ åŒ–ï¼ˆå–®ç­†å°æ²–ï¼‰</h4>
          <label class="small">é¸æ“‡å°æ²–çµæœèˆ‡é¡å‹ + è³ ç‡</label>
          <div class="row">
            <select id="g2-side">
              <option value="0">ä¸»å‹</option>
              <option value="1">å®¢å‹</option>
            </select>
            <select id="g2-type">
              <option value="Back">Backï¼ˆè²·é€²ï¼‰</option>
              <option value="Lay">Layï¼ˆè³£å‡ºï¼‰</option>
            </select>
            <input id="g2-odds" type="number" step="0.01" min="1" value="2.00" />
            <button class="btn" id="g2-calc">è¨ˆç®—å»ºè­°</button>
            <button class="btn-primary" id="g2-apply">å¥—ç”¨å»ºè­°</button>
          </div>
          <div id="g2-out" class="muted" style="margin-top:8px"></div>
        </div>
        <div class="box">
          <h4>3-Way å…¨ç›¤ç¶ åŒ–ï¼ˆå…©ç­†å°æ²–ï¼‰</h4>
          <label class="small">é¸æ“‡å…©å€‹è¦è£œçš„çµæœèˆ‡é¡å‹ + å°æ²–è³ ç‡</label>
          <div class="row">
            <select id="g3-side1">
              <option value="0">ä¸»å‹</option>
              <option value="1">å’Œå±€</option>
              <option value="2">å®¢å‹</option>
            </select>
            <select id="g3-type1">
              <option value="Back">Back</option>
              <option value="Lay">Lay</option>
            </select>
            <input id="g3-odds1" type="number" step="0.01" min="1" value="2.50" />
          </div>
          <div class="row">
            <select id="g3-side2">
              <option value="0">ä¸»å‹</option>
              <option value="1">å’Œå±€</option>
              <option value="2">å®¢å‹</option>
            </select>
            <select id="g3-type2">
              <option value="Back">Back</option>
              <option value="Lay">Lay</option>
            </select>
            <input id="g3-odds2" type="number" step="0.01" min="1" value="3.00" />
          </div>
          <div class="row" style="margin-top:6px">
            <button class="btn" id="g3-calc">è¨ˆç®—å»ºè­°</button>
            <button class="btn-primary" id="g3-apply">å¥—ç”¨å»ºè­°</button>
          </div>
          <div id="g3-out" class="muted" style="margin-top:8px"></div>
        </div>
      </div>
      <div class="foot">æç¤ºï¼šè‹¥å¹³å°æœ‰é™é¡ï¼å››æ¨äº”å…¥ï¼Œå¯¦éš›å¥—ç”¨å¾Œå¯èƒ½å‡ºç¾æ¥µå°ä¸ç­‰é¡ï¼›å¯å†å¾®èª¿æ³¨é¡ä»¥æ¶ˆé™¤ã€‚</div>
    </details>

    <!-- å¯æ”¶åˆï¼šå–®ä¸€å°æ²–ï¼ˆå¿«é€Ÿï¼‰ -->
    <details id="quickhedge" style="margin-top:8px">
      <summary>âš¡ å–®ä¸€å°æ²–ï¼ˆå¿«é€Ÿå…¬å¼ï¼‰</summary>
      <div class="grid2">
        <div class="box">
          <h4>Back â†’ Layï¼ˆå…ˆè²·å¾Œè³£ï¼‰</h4>
          <label class="small">Back è³ ç‡ / Stake â†’ Lay è³ ç‡</label>
          <div class="row">
            <input id="q-b-odds" type="number" step="0.01" min="1" value="3.00" />
            <input id="q-b-stake" type="number" step="0.01" min="0" value="1000" />
            <input id="q-b-layodds" type="number" step="0.01" min="1" value="2.20" />
            <button class="btn" id="q-b-go">è¨ˆç®—</button>
          </div>
          <div id="q-b-out" class="muted" style="margin-top:8px"></div>
        </div>
        <div class="box">
          <h4>Lay â†’ Backï¼ˆå…ˆè³£å¾Œè²·ï¼‰</h4>
          <label class="small">Lay è³ ç‡ / Stake â†’ Back è³ ç‡</label>
          <div class="row">
            <input id="q-l-odds" type="number" step="0.01" min="1" value="2.50" />
            <input id="q-l-stake" type="number" step="0.01" min="0" value="1000" />
            <input id="q-l-backodds" type="number" step="0.01" min="1" value="3.20" />
            <button class="btn" id="q-l-go">è¨ˆç®—</button>
          </div>
          <div id="q-l-out" class="muted" style="margin-top:8px"></div>
        </div>
      </div>
    </details>

    <!-- ä½£é‡‘èˆ‡é¡¯ç¤ºè¨­å®šï¼ˆè¼ƒä¸‹æ–¹ï¼‰ -->
    <div class="section-title">ä½£é‡‘èˆ‡é¡¯ç¤ºè¨­å®š</div>
    <div class="row">
      <div>
        <label class="small">ä½£é‡‘ç‡ï¼ˆ%ï¼‰</label>
        <input id="rate" type="number" value="5" min="0" step="0.01" />
      </div>
      <div>
        <label class="small">å°æ•¸ä½æ•¸</label>
        <input id="dp" type="number" value="2" min="0" max="6" />
      </div>
      <div>
        <label class="small">Lay è²¬ä»»é¡è­¦ç¤ºé–€æª»</label>
        <input id="liab-limit" type="number" value="10000" min="0" step="1" />
      </div>
    </div>

    <div class="foot">é‚è¼¯ï¼šå½™ç¸½å„çµæœ P/L â†’ è‹¥ç‚ºæ­£æ‰æ”¶ä½£é‡‘ â†’ é¡¯ç¤ºæ·¨é¡ã€‚ç¶ åŒ–å»ºè­°ä»¥æœªæ‰£ä½£é‡‘ç­‰é¡ç‚ºåŸºæº–ï¼Œå†é¡¯ç¤ºå«ä½£é‡‘å¾Œå·®è·ã€‚</div>
  </main>

  <script>
    // Helpers
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
    const dpEl = $('#dp'); const rateEl = $('#rate'); const liabLimitEl = $('#liab-limit');
    const fmt = (n) => (isFinite(n)? n:0).toFixed(Math.max(0, parseInt(dpEl.value)||0));
    const posClass = (el,n)=>{ el.classList.toggle('pos',n>0); el.classList.toggle('neg',n<0); };

    // Theme toggle with persistence
    const THEME_KEY = 'ex_theme_v1';
    function applyTheme(t){
      document.documentElement.setAttribute('data-theme', t);
      const btn = $('#theme-toggle');
      btn.textContent = (t==='dark') ? 'åˆ‡æ›ç‚ºæ·ºè‰²' : 'åˆ‡æ›ç‚ºæ·±è‰²';
    }
    function initTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      const t = saved || (prefersLight ? 'light' : 'dark');
      applyTheme(t);
    }
    $('#theme-toggle').addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = cur==='dark' ? 'light' : 'dark';
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    });
    initTheme();

    // Tabs
    $$('.tab').forEach(tab=>{
      tab.addEventListener('click',()=>{
        $$('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        const id = tab.dataset.tab;
        $$('.panel').forEach(p=>p.classList.remove('active'));
        $('#panel-'+id).classList.add('active');
      });
    });

    // --- 2-Way table ---
    const twoRows = $('#two-rows');
    function twoAddRow(data={}){
      const tr = document.createElement('tr');

      const tdIdx = document.createElement('td'); tdIdx.className='num'; tr.appendChild(tdIdx);

      const tdSide = document.createElement('td');
      const selSide = document.createElement('select');
      selSide.innerHTML = '<option value="0">ä¸»å‹</option><option value="1">å®¢å‹</option>';
      selSide.value = data.side ?? '0'; tdSide.appendChild(selSide); tr.appendChild(tdSide);

      const tdType = document.createElement('td');
      const selType = document.createElement('select');
      selType.innerHTML = '<option value="Back">Backï¼ˆè²·é€²ï¼‰</option><option value="Lay">Layï¼ˆè³£å‡ºï¼‰</option>';
      selType.value = data.type || 'Back'; tdType.appendChild(selType); tr.appendChild(tdType);

      const tdOdds = document.createElement('td');
      const inpOdds = document.createElement('input'); inpOdds.type='number'; inpOdds.step='0.01'; inpOdds.min='1'; inpOdds.value = data.odds ?? '';
      tdOdds.appendChild(inpOdds); tr.appendChild(tdOdds);

      const tdStake = document.createElement('td');
      const inpStake = document.createElement('input'); inpStake.type='number'; inpStake.step='0.01'; inpStake.min='0'; inpStake.value = data.stake ?? '';
      tdStake.appendChild(inpStake); tr.appendChild(tdStake);

      const tdP1 = document.createElement('td'); tdP1.className='num'; tdP1.textContent='0.00'; tr.appendChild(tdP1);
      const tdP2 = document.createElement('td'); tdP2.className='num'; tdP2.textContent='0.00'; tr.appendChild(tdP2);

      const tdDel = document.createElement('td');
      const del = document.createElement('button'); del.textContent='åˆªé™¤'; del.className='btn';
      del.onclick = ()=>{ tr.remove(); twoRenumber(); twoCalc(); };
      tdDel.appendChild(del); tr.appendChild(tdDel);

      [selSide, selType, inpOdds, inpStake, dpEl, rateEl, liabLimitEl].forEach(el=> el.addEventListener('input', twoCalc));
      twoRows.appendChild(tr);
      twoRenumber(); twoCalc();
    }
    function twoRenumber(){ $$('#two-rows tr').forEach((tr,i)=> tr.children[0].textContent = i+1 ); }
    function twoCalc(){
      let r = [0,0];
      $$('#two-rows tr').forEach(tr=>{
        const side = +tr.children[1].querySelector('select').value;
        const type = tr.children[2].querySelector('select').value;
        const odds = parseFloat(tr.children[3].querySelector('input').value);
        const stake = parseFloat(tr.children[4].querySelector('input').value);
        const tdP1 = tr.children[5], tdP2 = tr.children[6];
        if(!(odds>0 && stake>0)) { tdP1.textContent='0.00'; tdP2.textContent='0.00'; return; }
        const diff = odds - 1;
        let p = [0,0];
        if(type==='Back'){
          p[side] = stake*diff; p[1-side] = -stake;
        }else{
          p[side] = -stake*diff; p[1-side] = +stake;
          const liab = stake*diff;
          if(liab > parseFloat(liabLimitEl.value||'0')){
            tr.style.background = 'rgba(255,191,105,0.10)';
            tr.title = 'âš  è²¬ä»»é¡åé«˜ï¼š' + fmt(liab);
          }else{ tr.style.background='transparent'; tr.title=''; }
        }
        tdP1.textContent = fmt(p[0]);
        tdP2.textContent = fmt(p[1]);
        r[0]+=p[0]; r[1]+=p[1];
      });
      const rate = Math.max(0, parseFloat(rateEl.value)||0)/100;
      const comm = [ r[0]>0 ? r[0]*rate : 0, r[1]>0 ? r[1]*rate : 0 ];
      const net  = [ r[0]-comm[0], r[1]-comm[1] ];

      const r1 = $('#two-r1'), r2 = $('#two-r2');
      r1.textContent = fmt(r[0]); r2.textContent = fmt(r[1]);
      posClass(r1, r[0]); posClass(r2, r[1]);
      $('#two-r1-comm').textContent = fmt(comm[0]); $('#two-r2-comm').textContent = fmt(comm[1]);
      $('#two-r1-net').textContent  = fmt(net[0]);  $('#two-r2-net').textContent  = fmt(net[1]);
      const gap = Math.abs(net[0]-net[1]);
      const gapEl = $('#two-gap'); gapEl.textContent = fmt(gap); posClass(gapEl, net[0]-net[1]);
      return {r, comm, net, rate};
    }
    $('#two-add').onclick = ()=> twoAddRow();
    $('#two-clear').onclick = ()=> { twoRows.innerHTML=''; twoCalc(); };
    $('#two-demo').onclick = ()=>{
      twoRows.innerHTML='';
      twoAddRow({side:0, type:'Back', odds:1.90, stake:1000});
      twoAddRow({side:1, type:'Lay',  odds:2.10, stake:800});
    };

    // --- 3-Way table ---
    const threeRows = $('#three-rows');
    function threeAddRow(data={}){
      const tr = document.createElement('tr');

      const tdIdx = document.createElement('td'); tdIdx.className='num'; tr.appendChild(tdIdx);

      const tdSide = document.createElement('td');
      const selSide = document.createElement('select');
      selSide.innerHTML = '<option value="0">ä¸»å‹</option><option value="1">å’Œå±€</option><option value="2">å®¢å‹</option>';
      selSide.value = data.side ?? '0'; tdSide.appendChild(selSide); tr.appendChild(tdSide);

      const tdType = document.createElement('td');
      const selType = document.createElement('select');
      selType.innerHTML = '<option value="Back">Backï¼ˆè²·é€²ï¼‰</option><option value="Lay">Layï¼ˆè³£å‡ºï¼‰</option>';
      selType.value = data.type || 'Back'; tdType.appendChild(selType); tr.appendChild(tdType);

      const tdOdds = document.createElement('td');
      const inpOdds = document.createElement('input'); inpOdds.type='number'; inpOdds.step='0.01'; inpOdds.min='1'; inpOdds.value = data.odds ?? '';
      tdOdds.appendChild(inpOdds); tr.appendChild(tdOdds);

      const tdStake = document.createElement('td');
      const inpStake = document.createElement('input'); inpStake.type='number'; inpStake.step='0.01'; inpStake.min='0'; inpStake.value = data.stake ?? '';
      tdStake.appendChild(inpStake); tr.appendChild(tdStake);

      const tdh = document.createElement('td'); tdh.className='num'; tdh.textContent='0.00'; tr.appendChild(tdh);
      const tdd = document.createElement('td'); tdd.className='num'; tdd.textContent='0.00'; tr.appendChild(tdd);
      const tda = document.createElement('td'); tda.className='num'; tda.textContent='0.00'; tr.appendChild(tda);

      const tdDel = document.createElement('td');
      const del = document.createElement('button'); del.textContent='åˆªé™¤'; del.className='btn';
      del.onclick = ()=>{ tr.remove(); threeRenumber(); threeCalc(); };
      tdDel.appendChild(del); tr.appendChild(tdDel);

      [selSide, selType, inpOdds, inpStake, dpEl, rateEl, liabLimitEl].forEach(el=> el.addEventListener('input', threeCalc));
      threeRows.appendChild(tr);
      threeRenumber(); threeCalc();
    }
    function threeRenumber(){ $$('#three-rows tr').forEach((tr,i)=> tr.children[0].textContent = i+1 ); }
    function threeCalc(){
      let r = [0,0,0];
      $$('#three-rows tr').forEach(tr=>{
        const side = +tr.children[1].querySelector('select').value;
        const type = tr.children[2].querySelector('select').value;
        const odds = parseFloat(tr.children[3].querySelector('input').value);
        const stake = parseFloat(tr.children[4].querySelector('input').value);
        const tdh = tr.children[5], tdd = tr.children[6], tda = tr.children[7];
        if(!(odds>0 && stake>0)) { tdh.textContent='0.00'; tdd.textContent='0.00'; tda.textContent='0.00'; return; }
        const diff = odds - 1;
        let p = [0,0,0];
        if(type==='Back'){
          p[side] = stake*diff;
          for(let i=0;i<3;i++) if(i!==side) p[i]-=stake;
        }else{
          p[side] = -stake*diff;
          for(let i=0;i<3;i++) if(i!==side) p[i]+=stake;
          const liab = stake*diff;
          if(liab > parseFloat(liabLimitEl.value||'0')){
            tr.style.background = 'rgba(255,191,105,0.10)';
            tr.title = 'âš  è²¬ä»»é¡åé«˜ï¼š' + fmt(liab);
          }else{ tr.style.background='transparent'; tr.title=''; }
        }
        tdh.textContent=fmt(p[0]);
        tdd.textContent=fmt(p[1]);
        tda.textContent=fmt(p[2]);
        r[0]+=p[0]; r[1]+=p[1]; r[2]+=p[2];
      });
      const rate = Math.max(0, parseFloat(rateEl.value)||0)/100;
      const comm = r.map(x=> x>0 ? x*rate : 0);
      const net  = r.map((x,i)=> x-comm[i]);
      $('#three-h').textContent = fmt(r[0]); posClass($('#three-h'), r[0]);
      $('#three-d').textContent = fmt(r[1]); posClass($('#three-d'), r[1]);
      $('#three-a').textContent = fmt(r[2]); posClass($('#three-a'), r[2]);
      $('#three-h-comm').textContent=fmt(comm[0]); $('#three-h-net').textContent=fmt(net[0]);
      $('#three-d-comm').textContent=fmt(comm[1]); $('#three-d-net').textContent=fmt(net[1]);
      $('#three-a-comm').textContent=fmt(comm[2]); $('#three-a-net').textContent=fmt(net[2]);
      const gap = Math.max(...net) - Math.min(...net);
      $('#three-gap').textContent = fmt(gap);
      return {r,comm,net,rate};
    }
    $('#three-add').onclick = ()=> threeAddRow();
    $('#three-clear').onclick = ()=> { threeRows.innerHTML=''; threeCalc(); };
    $('#three-demo').onclick = ()=>{
      threeRows.innerHTML='';
      threeAddRow({side:0, type:'Back', odds:1.24, stake:1000});
      threeAddRow({side:2, type:'Back', odds:14.5, stake:100});
      threeAddRow({side:1, type:'Lay',  odds:7.20, stake:200});
    };

    // --- Green-up helpers ---
    function unitVector(side, type, odds, dim){
      const v = new Array(dim).fill(type==='Lay'? +1 : -1);
      v[side] = (type==='Lay')? -(odds-1) : (odds-1);
      return v;
    }
    // 2-Way green-up
    $('#g2-calc').onclick = ()=>{
      const state = (function(){
        // recalc and fetch raw totals from UI quickly
        const rText1 = $('#two-r1').textContent;
        // ensure we have latest via compute:
        return twoCalc();
      })();
      const side = parseInt($('#g2-side').value);
      const type = $('#g2-type').value;
      const odds = parseFloat($('#g2-odds').value);
      if(!(odds>0)){ $('#g2-out').innerHTML = '<span class="warn">è«‹è¼¸å…¥æ­£ç¢ºè³ ç‡ã€‚</span>'; return; }
      const v = unitVector(side, type, odds, 2);
      const s = (state.r[1] - state.r[0]) / (v[0] - v[1]);
      const out = $('#g2-out');
      if(!isFinite(s) || s<=0){ out.innerHTML = '<span class="warn">ç„¡æ³•è¨ˆç®—ï¼šè«‹ç¢ºèªè³ ç‡èˆ‡é¡å‹ã€‚</span>'; return; }
      const rNew = [ state.r[0] + s*v[0], state.r[1] + s*v[1] ];
      const comm = rNew.map(x=> x>0 ? x*state.rate : 0);
      const net  = rNew.map((x,i)=> x-comm[i]);
      out.innerHTML = `å»ºè­°ä¸‹å–®ï¼š<strong>${type}</strong> â†’ <strong>${side===0?'ä¸»å‹':'å®¢å‹'}</strong>ï¼Œè³ ç‡ <strong>${odds}</strong>ï¼Œ<strong>Stake â‰ˆ ${fmt(s)}</strong>
      <br>åŠ å–®å¾Œï¼ˆå«ä½£é‡‘ï¼‰ï¼šNet1 = <strong>${fmt(net[0])}</strong>ï¼ŒNet2 = <strong>${fmt(net[1])}</strong>ï¼Œå·®è· = <strong>${fmt(Math.abs(net[0]-net[1]))}</strong>`;
      out.dataset.s = s; out.dataset.side = side; out.dataset.type = type; out.dataset.odds = odds;
    };
    $('#g2-apply').onclick = ()=>{
      const s = parseFloat($('#g2-out').dataset.s||'0');
      if(!(s>0)) return;
      twoAddRow({ side: parseInt($('#g2-out').dataset.side), type: $('#g2-out').dataset.type, odds: parseFloat($('#g2-out').dataset.odds), stake: s });
      $('#g2-out').innerHTML += '<br>âœ… å·²æ–°å¢åˆ° 2-Way è¡¨æ ¼ã€‚';
    };

    // 3-Way green-up
    $('#g3-calc').onclick = ()=>{
      const state = threeCalc();
      const side1 = parseInt($('#g3-side1').value);
      const side2 = parseInt($('#g3-side2').value);
      if(side1===side2){ $('#g3-out').innerHTML = '<span class="warn">è«‹é¸æ“‡å…©å€‹ä¸åŒçµæœã€‚</span>'; return; }
      const type1 = $('#g3-type1').value, type2 = $('#g3-type2').value;
      const o1 = parseFloat($('#g3-odds1').value), o2 = parseFloat($('#g3-odds2').value);
      if(!(o1>0 && o2>0)){ $('#g3-out').innerHTML = '<span class="warn">è«‹è¼¸å…¥æ­£ç¢ºè³ ç‡ã€‚</span>'; return; }
      const v = unitVector(side1,type1,o1,3);
      const w = unitVector(side2,type2,o2,3);
      const A11 = (v[1]-v[0]), A12 = (w[1]-w[0]), B1 = (state.r[0]-state.r[1]);
      const A21 = (v[2]-v[0]), A22 = (w[2]-w[0]), B2 = (state.r[0]-state.r[2]);
      const det = A11*A22 - A12*A21;
      const out = $('#g3-out');
      if(Math.abs(det) < 1e-9){ out.innerHTML = '<span class="warn">ç„¡æ³•è¨ˆç®—ï¼šä¿‚æ•¸é€€åŒ–ï¼Œè«‹æ›ä¸€çµ„é¡å‹æˆ–è³ ç‡ã€‚</span>'; return; }
      const s = (B1*A22 - B2*A12) / det;
      const t = (A11*B2 - A21*B1) / det;
      if(!isFinite(s) || !isFinite(t) || s<=0 || t<=0){
        out.innerHTML = '<span class="warn">æ±‚å¾—çš„æ³¨é¡ â‰¤ 0ï¼Œè«‹èª¿æ•´é¡å‹æˆ–è³ ç‡ã€‚</span>'; return;
      }
      const rNew = [
        state.r[0] + s*v[0] + t*w[0],
        state.r[1] + s*v[1] + t*w[1],
        state.r[2] + s*v[2] + t*w[2],
      ];
      const comm = rNew.map(x=> x>0 ? x*state.rate : 0);
      const net  = rNew.map((x,i)=> x-comm[i]);
      const gap = Math.max(...net) - Math.min(...net);
      out.innerHTML = `å»ºè­°ä¸‹å–® 1ï¼š<strong>${type1}</strong> â†’ <strong>${['ä¸»å‹','å’Œå±€','å®¢å‹'][side1]}</strong>ï¼Œè³ ç‡ <strong>${o1}</strong>ï¼Œ<strong>Stake â‰ˆ ${fmt(s)}</strong>
      <br>å»ºè­°ä¸‹å–® 2ï¼š<strong>${type2}</strong> â†’ <strong>${['ä¸»å‹','å’Œå±€','å®¢å‹'][side2]}</strong>ï¼Œè³ ç‡ <strong>${o2}</strong>ï¼Œ<strong>Stake â‰ˆ ${fmt(t)}</strong>
      <br>åŠ å–®å¾Œï¼ˆå«ä½£é‡‘ï¼‰ï¼šNet(H/D/A) = <strong>${fmt(net[0])}</strong> / <strong>${fmt(net[1])}</strong> / <strong>${fmt(net[2])}</strong>ï¼›ä¸å¹³è¡¡åº¦ = <strong>${fmt(gap)}</strong>`;
      out.dataset.s = s; out.dataset.t = t; out.dataset.side1 = side1; out.dataset.side2 = side2;
      out.dataset.type1 = type1; out.dataset.type2 = type2; out.dataset.o1 = o1; out.dataset.o2 = o2;
    };
    $('#g3-apply').onclick = ()=>{
      const out = $('#g3-out');
      const s = parseFloat(out.dataset.s||'0');
      const t = parseFloat(out.dataset.t||'0');
      if(!(s>0 && t>0)) return;
      threeAddRow({ side: parseInt(out.dataset.side1), type: out.dataset.type1, odds: parseFloat(out.dataset.o1), stake: s });
      threeAddRow({ side: parseInt(out.dataset.side2), type: out.dataset.type2, odds: parseFloat(out.dataset.o2), stake: t });
      out.innerHTML += '<br>âœ… å·²æ–°å¢åˆ° 3-Way è¡¨æ ¼ã€‚';
    };

    // Quick hedge formulas
    $('#q-b-go').onclick = ()=>{
      const Ob = parseFloat($('#q-b-odds').value);
      const S  = parseFloat($('#q-b-stake').value);
      const Ol = parseFloat($('#q-b-layodds').value);
      if(!(Ob>1 && Ol>1 && S>0)){ $('#q-b-out').innerHTML = '<span class="warn">è«‹è¼¸å…¥æ­£ç¢ºæ•¸å€¼ã€‚</span>'; return; }
      const L = S * (Ob / Ol);
      const rate = Math.max(0, parseFloat(rateEl.value)||0)/100;
      const eqProfit = L - S;
      const netApprox = eqProfit * (1 - rate);
      $('#q-b-out').innerHTML = `å»ºè­° Lay stake â‰ˆ <strong>${fmt(L)}</strong>ã€‚æœªæ‰£ä½£ç­‰é¡åˆ©æ½¤ â‰ˆ <strong>${fmt(eqProfit)}</strong>ï¼Œå«ä½£è¿‘ä¼¼ â‰ˆ <strong>${fmt(netApprox)}</strong>`;
    };
    $('#q-l-go').onclick = ()=>{
      const Ol = parseFloat($('#q-l-odds').value);
      const S  = parseFloat($('#q-l-stake').value);
      const Ob = parseFloat($('#q-l-backodds').value);
      if(!(Ob>1 && Ol>1 && S>0)){ $('#q-l-out').innerHTML = '<span class="warn">è«‹è¼¸å…¥æ­£ç¢ºæ•¸å€¼ã€‚</span>'; return; }
      const B = S * (Ol / Ob);
      const rate = Math.max(0, parseFloat(rateEl.value)||0)/100;
      const eqProfit = S - B;
      const netApprox = eqProfit * (1 - rate);
      $('#q-l-out').innerHTML = `å»ºè­° Back stake â‰ˆ <strong>${fmt(B)}</strong>ã€‚æœªæ‰£ä½£ç­‰é¡åˆ©æ½¤ â‰ˆ <strong>${fmt(eqProfit)}</strong>ï¼Œå«ä½£è¿‘ä¼¼ â‰ˆ <strong>${fmt(netApprox)}</strong>`;
    };

    // Seed one empty row per panel
    twoAddRow();
    threeAddRow();
  </script>
</body>
</html>
